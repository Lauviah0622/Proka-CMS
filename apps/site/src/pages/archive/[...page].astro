---
import Archive from '~/layouts/Archive.astro'
import sort from '~/utils/sortPosts'

export async function getStaticPaths({ paginate }) {
  const PAGE_SIZE = 20
  let allPosts = await Astro.glob('/src/pages/posts/*.md')

  const getSlug = (url: string) => url.match(/\/([\w-]*?)$/)?.[1]
  const getTransedPostUrl = (url: string) => {
    const slug = getSlug(url)
    if (!slug) throw Error('error file path')
    // TODO: put this into the metadata
    const postBasePath = 'post'
    return `/${postBasePath}/${slug}`
  }

  const sortedPage = sort(
    [...allPosts].map((post) => ({
      ...post,
      url: getTransedPostUrl(post.url ?? ''),
    }))
  )
  return paginate(sortedPage, { pageSize: PAGE_SIZE })
}

const { page } = Astro.props

const baseUrl = '/archive/'
---

<Archive page={page} baseUrl={baseUrl} />
